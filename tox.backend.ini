[tox]
requires = tox>=4.11
env_list =
    py311-lint
    py311-format
    py311-type
    py311-test
    py311-integration
    py311-build

[testenv]
package = skip
setenv =
    PYTHONPATH = {toxinidir}/backend
pass_env =
    DATABASE_URL
    PYTHONPATH
deps =
    ruff>=0.6,<1
    mypy>=1.10,<2
    pytest>=7.4,<9
    pytest-asyncio>=0.23,<1
    httpx>=0.27,<1
    build>=1,<2
commands_pre =
    python -m pip install --upgrade pip
    python -m pip install -e backend
allowlist_externals =
    python

[testenv:py311-lint]
description = Ruff lint backend
commands =
    python -m ruff check --config backend/pyproject.toml backend/app backend/tests

[testenv:py311-format]
description = Enforce Ruff formatter
commands =
    python -m ruff format --config backend/pyproject.toml --check backend

[testenv:py311-type]
description = Type checking with mypy
commands =
    python -m mypy --config-file backend/pyproject.toml backend/app

[testenv:py311-test]
description = Run backend pytest suite
commands =
    python -m pytest backend/tests

[testenv:py311-integration]
description = Run backend integration smoke (app startup, static files)
commands =
    python -m pytest backend/tests/test_app.py

[testenv:py311-build]
description = Build backend distribution artefacts
commands =
    python -m build backend


